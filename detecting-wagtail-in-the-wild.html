<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Detecting Wagtail in the wild - Thibaud’s blog</title>

  <link rel="stylesheet" href="/css/screen.css">

  
  <meta name="description" content="How can you tell if a site is made with Wagtail or not? There are more ways than people might think at first sight, and after a few years of toying with the ...">
  <meta name="author" content="Thibaud Colas"><link rel="canonical" href="https://thib.me/detecting-wagtail-in-the-wild">
  <link href="/favicon.ico" rel="shortcut icon">
  <link href="/atom.xml" rel="alternate" title="Thibaud’s blog" type="application/atom+xml">

  <meta name="twitter:card" content="summary_large_image">
  <meta property="og:url" content="https://thib.me/detecting-wagtail-in-the-wild">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="Thibaud’s blog">
  <meta name="twitter:site" content="@thibaud_colas">
  <meta name="twitter:creator" content="@thibaud_colas">
  <meta property="og:title" content="Detecting Wagtail in the wild">
  <meta property="og:description" content="How can you tell if a site is made with Wagtail or not? There are more ways than people might think at first sight, and after a few years of toying with the ...">
  
  <meta name="twitter:label1" value="Reading time">
  <meta name="twitter:data1" value="Not too long">

  <link rel="meta" title="FOAF" type="application/rdf+xml" href="/foaf.rdf">

  
  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-34692999-4','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>


</head>

<body   >
  <header><hgroup>
  <h1><a href="/">Thibaud’s blog</a></h1>
  
    <h2>Notes, thoughts, and open-source software</h2>
  
</hgroup>

</header>
  <nav>  
<ul class="main-navigation">
  <li><a href="https://twitter.com/thibaud_colas">Twitter</a></li>
  <li><a href="https://github.com/thibaudcolas">GitHub</a></li>
  <li><a href="/resume" data-no-instant>Resume</a></li>
  <li><a href="/about/">About</a></li>
</ul>

</nav>
  <div role="main" id="main">
    <div id="content">
      <div class="blog-index">
<article class="hentry">
  
  <header>
    
      <a class="edit-link" aria-label="Edit this page on GitHub" href="https://github.com/thibaudcolas/thibaudcolas/edit/main/src/_posts/2020-11-18-detecting-wagtail-in-the-wild.md">Edit</a>
      <h1 class="entry-title">Detecting Wagtail in the wild</h1>
    
    
      <p class="meta">
        









<time datetime="2020-11-18T15:15:22+00:00" pubdate data-updated="true">2020-11-18 15:15</time>
        
      </p>
    
  </header>


<div class="entry-content" data-no-instant><p>How can you tell if a site is made with Wagtail or not? There are more ways than people might think at first sight, and after a few years of toying with the idea I finally put together a way to detect Wagtail sites that strikes a good balance between reliability and convenience. Let’s go birdwatching.</p>

<!-- more -->

<h2 id="ways-to-detect-wagtail">Ways to detect Wagtail</h2>

<p>I could think of a few <a href="https://github.com/springload/madewithwagtail/issues/62">when I first started thinking of this problem</a>:</p>

<ul>
  <li>Determine if the site is built with Django. See https://stackoverflow.com/questions/721934/how-can-you-tell-if-a-site-has-been-made-with-django (that’s a start)</li>
  <li>Check if the site uses a Wagtail badge (https://wagtail.io/wagtail-badges/) (not too frequently used)</li>
  <li>Load <code class="language-plaintext highlighter-rouge">/admin/login</code> and check for “wagtail” in the response (either in the page title, or wagtailadmin JS file – that’s a 100% tell I think).</li>
</ul>

<p>The problem with a lot of those approaches is that they rely on crawling the site, which isn’t very reliable, and can be complicated to do in batches across a lot of sites. It’s also unclear how common the signs above would be across the breadth of Wagtail sites.</p>

<p>The ideal approach would be HTTP response headers – which could be obtained from any pages with a lightweight HEAD request. Wagtail unfortunately doesn’t have any, so the next best thing is to inspect the pages’ markup:</p>

<ul>
  <li>Wagtail’s (legacy) rich text uses the <code class="language-plaintext highlighter-rouge">rich-text</code> class to wrap the HTML of rich text fields</li>
  <li>Rich text images use hard-coded classes like <a href="https://github.com/wagtail/wagtail/blob/bb2e460c0b92fba802fc3f369730004d6b648e64/wagtail/images/formats.py#L91-L94"><code class="language-plaintext highlighter-rouge">richtext-image full-width</code></a></li>
  <li>Wagtail’s documents are served from a <a href="https://github.com/wagtail/wagtail/blob/bb2e460c0b92fba802fc3f369730004d6b648e64/wagtail/documents/urls.py#L6"><code class="language-plaintext highlighter-rouge">/documents/</code></a> sub-path.</li>
  <li>And many more of these</li>
</ul>

<p>The Wagtail markup that’s the most common is <a href="https://docs.wagtail.io/en/stable/topics/images.html?highlight=renditions#generating-image-renditions-in-python">image renditions</a> URLs. This does mean that this detection only works on pages that contain user-uploaded images (as opposed to static images). Here are a few examples of URLs from renditions:</p>

<pre><code class="language-txt">https://www.jazzfestival.nz/media/images/video-fallback-image_1.width-1920.png
/media/images/bevi_3_mob.original.format-png.png
/media/original_images/Social_Distancing_Dashboard_-_image_1_TU_DelftAMS_Institute.png
https://buckup-ff-stories.s3.amazonaws.com/original_images/Lockup_Logo_-_JPEG-1.png
/media/images/UE4LowPolyVehicleTh.2e16d0ba.fill-960x540-c0.jpg
</code></pre>

<p>The distinctive features are the folders – always either <code class="language-plaintext highlighter-rouge">images</code> or <code class="language-plaintext highlighter-rouge">original_images</code>, either placed directly at the root of a site, or from a <code class="language-plaintext highlighter-rouge">/media</code> subfolder at the root, or a single level up. And then the fact that all of the site’s images are placed in those two folders without any additional sub-folders, with file name suffixes following a set format for all files under <code class="language-plaintext highlighter-rouge">images/</code> like <code class="language-plaintext highlighter-rouge">.width-1920</code> or <code class="language-plaintext highlighter-rouge">.fill-960x450-c0</code> above. I came up with the particular regex used here after trying out different variations on 800’000 homepages from the <a href="https://majestic.com/reports/majestic-million">Majestic Million</a> list of domains.</p>

<h2 id="the-regex">The regex</h2>

<p>Here is a simplified diagram of the logic (created with <a href="https://regexper.com/#%5C%2F%28original_images%5C%2F%5B%5Cw-%5D%2B%5C.%7Cimages%5C%2F%5B%5Cw-.%5D%2B%5C.%28%28fill%7Cmax%7Cmin%7Cwidth%7Cheight%7Cscale%29-%5Cd%7Coriginal%29%29">regexper</a>):</p>

<p><img src="/images/blog/detecting-wagtail-in-the-wild/regexper-diagram.svg" alt="regexper train diagram of Wagtail regular expressions" /></p>

<h2 id="real-world-usage">Real-world usage</h2>

<p>It could be more complex and precise but this wouldn’t actually change much to its real-world usefulness, so I gradually simplified it to the above. With this in place, we can then create different ways to run this detection on arbitrary websites:</p>

<ul>
  <li>The online website, <a href="https://detect-wagtail.netlify.app/">detect-wagtail.netlify.app</a>.</li>
  <li>A bookmarket, also available from <a href="https://detect-wagtail.netlify.app/">detect-wagtail.netlify.app</a>.</li>
  <li>A browser extension thanks to <a href="https://github.com/AliasIO/wappalyzer">Wappalyzer</a>.</li>
  <li>A Node CLI, also thanks to <a href="https://github.com/AliasIO/wappalyzer">Wappalyzer</a>.</li>
  <li>As an npm package for more custom needs, <a href="https://www.npmjs.com/package/detect-wagtail">detect-wagtail</a></li>
</ul>

<h2 id="real-world-data">Real-world data</h2>

<p>With this regex in place, I tried it out on a few lists of websites. See <a href="https://github.com/thibaudcolas/detect-wagtail/tree/main/docs/analysis">detect-wagtail/docs/analysis</a> for the full details.</p>

<h3 id="eu-public-sector-websites">EU public sector websites</h3>

<p>From <a href="https://www.funka.com/en/projekt/we4authors/">We4authors</a>. Based on this analysis, 3 national-level public sector websites are built with Wagtail:</p>

<pre><code class="language-txt">www.danepubliczne.gov.pl
www.nhs.uk
www.nesta.org.uk
</code></pre>

<h3 id="us-federal-websites">US federal websites</h3>

<p>Analysis of the US federal websites from the <a href="https://github.com/GSA/digitalgov.gov/blob/main/content/resources/content-management-systems-used-by-government-agencies.md">digital.gov list</a>.</p>

<pre><code class="language-txt">fec.gov
www.peacecorps.gov
www.consumerfinance.gov
</code></pre>

<h3 id="made-with-wagtail">Made with Wagtail</h3>

<p><a href="https://madewithwagtail.org/">Made with Wagtail</a> is a showcase of a lot of Wagtail sites and apps. About two thirds of sites listed are detected with the following regular expressions.</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ag <span class="s1">'\/(original_images\/[\w-]+\.|images\/[\w-.]+\.((fill|max|min|width|height|scale)-\d|original))'</span> mww <span class="nt">--stats-only</span>
<span class="c"># 382 files contained matches</span>
ag <span class="s1">'\/media\/(original_images\/[\w-]+\.|images\/[\w-.]+\.((fill|max|min)-\d+x\d+(-c\d+)?|(width|height|scale)-\d+|original)\.)'</span> mww <span class="nt">--stats-only</span>
<span class="c"># 292 files contained matches</span>
</code></pre></div></div>

<h3 id="majestic-million">Majestic Million</h3>

<p>The <a href="https://majestic.com/reports/majestic-million">Majestic Million</a> is a dataset of 1M domain names ordered by popularity. We can also use the above methodology to assess how many websites are made with Wagtail on this list (about 0.05%).</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ag <span class="s1">'\/media\/(original_images\/[\w-]+\.|images\/[\w-.]+\.((fill|max|min)-\d+x\d+(-c\d+)?|(width|height|scale)-\d+|original)\.)'</span> million <span class="nt">--stats-only</span>
<span class="c"># 296 files contained matches</span>
ag <span class="s1">'\/(original_images\/[\w-]+\.|images\/[\w-.]+\.((fill|max|min|width|height|scale)-\d|original))'</span> ../detect-wagtail-data/million <span class="nt">--stats-only</span>
<span class="c"># 528 files contained matches</span>
</code></pre></div></div>

<h2 id="security-implications">Security implications</h2>

<p>Based on this research, it’s now obvious telling whether a site is built with Wagtail or not really doesn’t take that much effort. It’s also clear that this is completely doable at a large scale, scanning the web for vulnerable Wagtail sites, as is commonplace for other platforms. The common wisdom is to avoid relying on <a href="https://en.wikipedia.org/wiki/Security_through_obscurity">security through obscurity</a>. Some people do argue that some obscurity doesn’t hurt. Don’t count on it. Take the time to establish a threat model for your site, and protect it accordingly by restricting its access, and implementing brute force protections where relevant.</p>

<p>Also keep your site up-to-date with security fixes for all its dependencies. While the approach described here doesn’t make it possible to determine which version of Wagtail is used – there are other very viable approach that make this equally as easy (see <a href="https://github.com/caioariede/detect-django-version">detect-django-version</a> for inspiration).</p>

<h2 id="applications">Applications</h2>

<p>There are a lot more applications to being able to detect Wagtail websites than just knowing how many there are out there. <a href="WhatCMS.org">WhatCMS.org</a> has had some amount of Wagtail data for years and is a good example of the potential for market analysis. For me, I’m more interested in seeing how Wagtail is used in the wild. Here are interesting questions this could help with:</p>

<ul>
  <li>Wagtail headless usage – which static site generators are the most common with Wagtail, that would be worth documenting the usage of better.</li>
  <li>Security best practices – how many websites have the Wagtail admin accessible from any IP vs being restricted.</li>
  <li>Accessibility – how accessible Wagtail sites are.</li>
</ul>

<p>This last point is the one I’m the most interested in – in particular, comparing Wagtail’s results to those of other technologies in the <a href="https://webaim.org/projects/million/">WebAIM Million</a>. We’ll see how that goes!</p>
</div>



  <footer>
    <p class="meta">
      
<span class="byline author vcard">By <span class="fn">Thibaud Colas</span></span>

      









<time datetime="2020-11-18T15:15:22+00:00" pubdate data-updated="true">2020-11-18 15:15</time>
      

<span class="categories">
  
    
      <a class="category" href="/categories/automation/">Automation</a>,
    
      <a class="category" href="/categories/wagtail/">Wagtail</a>,
    
      <a class="category" href="/categories/experiments/">Experiments</a>
    
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/accessibility-wins-for-django-projects" title="Previous Post: Accessibility wins for Django projects">&laquo; Accessibility wins for Django projects</a>
      
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/detecting-wagtail-in-the-wild">Detecting Wagtail in the wild</a>
      </li>
    
      <li class="post">
        <a href="/accessibility-wins-for-django-projects">Accessibility wins for Django projects</a>
      </li>
    
      <li class="post">
        <a href="/testing-accessibility-in-ci-with-pa11y-and-beyond">Testing accessibility in Continuous Integration with Pa11y and beyond</a>
      </li>
    
      <li class="post">
        <a href="/reusable-ui-components-journey-from-react-to-wagtail">Reusable UI components – A journey from React to Wagtail</a>
      </li>
    
      <li class="post">
        <a href="/accessibility-wins-for-wagtail-projects">Accessibility wins for Wagtail projects</a>
      </li>
    
  </ul>
</section>

  
<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos" data-user="thibaudcolas" data-count="5">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/thibaudcolas">@thibaudcolas</a> on GitHub
  
  <script src="/javascripts/github.js"></script>
</section>


</aside>


    </div>
  </div>
  <footer><p>
  By <a href="" rel="author">Thibaud Colas</a> -
  Content available under <a class="license" rel="license" href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a> -
  <span class="credit">Hosted on <a href="https://pages.github.com/">GitHub Pages</a></span> -
  <a class="fork-link" href="https://github.com/thibaudcolas/thibaudcolas">View source</a>
</p>

</footer>
  

<script src="/javascripts/libs/instantclick.min.js" data-no-instant></script>
<script data-no-instant>InstantClick.init(50);</script>


</body>
</html>
